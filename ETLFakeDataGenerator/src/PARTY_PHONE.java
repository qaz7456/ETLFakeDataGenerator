import java.io.BufferedWriter;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.List;
import java.util.Random;

import tw.com.fakedatagenerator.party.phone.mode.Detail;
import tw.com.fakedatagenerator.util.RandomValue;
import tw.com.fakedatagenerator.util.Utils;
import tw.com.fakedatagenerator.mode.Footer;
import tw.com.fakedatagenerator.mode.Header;

public class PARTY_PHONE {

	/*
	 * 農漁會
	 * 新北市農會附設北區農會電腦共用中心 ：951 
	 * 財團法人農漁會南區資訊中心 ：952 
	 * 板橋區農會電腦共用中心 ：928
	 * 財團法人農漁會聯合資訊中心：910 
	 * 高雄市農會 ：605 
	 * 農漁會資訊共用系統 ：600
	 */
	private static String[] CENTRAL_NO_ARRAY = { "951", "952", "928", "910", "605", "600" };
	
	/*
	 * 本會代號 (配賦代號)
	 */
	private static String[] DOMAIN_ID_ARRAY = {"5030019","5040010","5040021","5040032","5040054","5050011","5050022","5050033","5050066","5050077","5060012","5070013","5080014","5080025","5100019","5100020","5110010","5110021","5110032","5110043","5110054","5110065","5110076","5110087","5120011","5120022","5120033","5120044","5120055","5150014","5150025","5150036","5150047","5150058","5150069","5150070","5150081","5170016","5170027","5170038","5180017","5180028","5180039","5180040","5180051","5180073","5190018","5190029","5190030","5200012","5200023","5200034","5200056","5210024","5210035","5210068","5210079","5210091","5210105","5210116","5210149","5230015","5230037","5230048","5230059","5230082","5230093","5230118","5230129","5230130","5240016","5250017","5250028","5250039","5260018","5410019","5410020","5410031","5410042","5410053","5410064","5420010","5420021","5420032","5420043","5470015","5470026","5470037","5470048","5470059","5470060","5490017","5490028","5490039","5490040","5510012","5510023","5510034","5510045","5510056","5510067","5520013","5520024","5520035","5520046","5560017","5560028","5560039","5560040","5560051","5560062","5570018","5570029","5580019","5580020","5580031","5580042","5580053","5590010","5610015","5620016","5620027","5620038","5620049","5620050","5620061","5640018","5640029","5640030","5650019","5650020","5670011","5680012","5700017","5700028","5700039","5700040","5700051","5700062","5700073","5700084","5730010","5730021","5730032","5730043","5740011","5740022","5740033","5740044","5740055","5750012","5750023","5750034","5750045","5770014","5770025","5770036","5770047","5770058","5770069","5780015","5780026","5780037","5780048","5790016","5790027","5790038","5790049","5790050","5790061","5790072","5800010","5800021","5800032","5800043","5800054","5800065","5800076","5800087","5810011","5810022","5810033","5820012","5830013","5830024","5830035","5830046","5830057","5870017","5870028","5870039","5870040","6030016","6030027","6030038","6030049","6050018","6050029","6050030","6050041","6050052","6050063","6050074","6050085","6050096","6050100","6050111","6050122","6050133","6051336","6060019","6060020","6060031","6060042","6060053","6060064","6060075","6060097","6060101","6060112","6060123","6060134","6060145","6060156","6060167","6060178","6060189","6060190","6060204","6060215","6060226","6060237","6060248","6060259","6060260","6060271","6060282","6060293","6060318","6060329","6060330","6060341","6060352","6060363","6060385","6060396","6060400","6060411","6060422","6060433","6060444","6060455","6060466","6060477","6060488","6060499","6060503","6060514","6060547","6060558","6060569","6060570","6060581","6060592","6060606","6060639","6060640","6060651","6060662","6060673","6060684","6060695","6060709","6060710","6060721","6060732","6060743","6060754","6060765","6060776","6060787","6060798","6060802","6060813","6060824","6060835","6060846","6060857","6060868","6060891","6060905","6060916","6060927","6060938","6060949","6060950","6060961","6060983","6060994","6061005","6061016","6061027","6061038","6061061","6061072","6061083","6061094","6061108","6061119","6061120","6061131","6061142","6061153","6061175","6061186","6061197","6061201","6061212","6061223","6061245","6061267","6061278","6061289","6061290","6061315","6061326","6061337","6061348","6061359","6061360","6070010","6070021","6070032","6070054","6070065","6070076","6070087","6070098","6070102","6070113","6070135","6070146","6070157","6070168","6070179","6070180","6070191","6070205","6070216","6070227","6070238","6070249","6070250","6070272","6070283","6070308","6070319","6070331","6070342","6070353","6070364","6070375","6070386","6070412","6070423","6070434","6070445","6070467","6070489","6070515","6070526","6080011","6080033","6080044","6080055","6080066","6080077","6080088","6080099","6080103","6080114","6080136","6080147","6080158","6080169","6080170","6080181","6080192","6080206","6080217","6080228","6080239","6080240","6080251","6080262","6080273","6080284","6080295","6080309","6080310","6080321","6080365","6080376","6080387","6080398","6080402","6080413","6080424","6080435","6080446","6080457","6080468","6080479","6080480","6080491","6080505","6080516","6080527","6080538","6080549","6080550","6080561","6080572","6080583","6080594","6080619","6080620","6080631","6080642","6080653","6080664","6080686","6080697","6080712","6080723","6080745","6080756","6080767","6080778","6080790","6080804","6080826","6080837","6080848","6080859","6090089","6090090","6090104","6100016","6100027","6100038","6100050","6100061","6100072","6100083","6100094","6100108","6100119","6100120","6100131","6100142","6100153","6100186","6100197","6100201","6100212","6100223","6100234","6100256","6100267","6100289","6100290","6100304","6100315","6100326","6100337","6100348","6100359","6100360","6100371","6100382","6100393","6100429","6100430","6100441","6100452","6100463","6100474","6100485","6110062","6110501","6120085","6120096","6120236","6120247","6120258","6120269","6120270","6120281","6120292","6120443","6120557","6120568","6120834","6120867","6120890","6121015","6121093","6121107","6121118","6130020","6130031","6130075","6130189","6130260","6130271","6130282","6130293","6130466","6130488","6130499","6130606","6130617","6130673","6130684","6130754","6140043","6140087","6140124","6140179","6140180","6140227","6140261","6140320","6140401","6140412","6140423","6140478","6140515","6140526","6140559","6140593","6140696","6140700","6140711","6140733","6140799","6140858","6140870","6141017","6141028","6141291","6141327","6141338","6160012","6160023","6160034","6160056","6160078","6160089","6160090","6160115","6160126","6160137","6160148","6160160","6160171","6160218","6160230","6160241","6160252","6160263","6160274","6160285","6160296","6160300","6160311","6160322","6160333","6160403","6160414","6160436","6160447","6160458","6160469","6160492","6160506","6160517","6160528","6160539","6160540","6160562","6160573","6160595","6160609","6160610","6160621","6160643","6160665","6160698","6160702","6160713","6160735","6160746","6160757","6160779","6170013","6170024","6170035","6170046","6170057","6170068","6170079","6170080","6170091","6170105","6170116","6170138","6170149","6170150","6170172","6170194","6170208","6170219","6170220","6170231","6170242","6170253","6170275","6170286","6170297","6170301","6170312","6170323","6170334","6170345","6170356","6170367","6170378","6170389","6170390","6170404","6170415","6170426","6170437","6170448","6170459","6170460","6170471","6170482","6170493","6170507","6170518","6170563","6170574","6170585","6170596","6170600","6170611","6170622","6170633","6170644","6170655","6170666","6170677","6170688","6170699","6170703","6170714","6170725","6170758","6170769","6170781","6170806","6170817","6170862","6171261","6171272","6171283","6171320","6171331","6171353","6171364","6171375","6171386","6171397","6171401","6171412","6171423","6171434","6171467","6171478","6171489","6171490","6180025","6180036","6180069","6180081","6180092","6180139","6180162","6180184","6180195","6180243","6180298","6180324","6180335","6180346","6180357","6180368","6180416","6180427","6180438","6180449","6180450","6180461","6180472","6180483","6180494","6180508","6180612","6180689","6180715","6180771","6180782","6180793","6180807","6180818","6180829","6180966","6180977","6180988","6181011","6181066","6181158","6181181","6181206","6181217","6181239","6181240","6181262","6181343","6181365","6181402","6190015","6190026","6190037","6190048","6190059","6190060","6190071","6190082","6190093","6190107","6190118","6190129","6190130","6190141","6190185","6190196","6190211","6190222","6190244","6190255","6190266","6190277","6190288","6190299","6190303","6190314","6190325","6190336","6190347","6190358","6190369","6190370","6190381","6190392","6190406","6190417","6190428","6190439","6190440","6190451","6190462","6190473","6190484","6190495","6190565","6190576","6190587","6190598","6190602","6190624","6190646","6190657","6190679","6190680","6190716","6190727","6190738","6190749","6190750","6190761","6190772","6190783","6190794","6190808","6190819","6190831","6190853","6190864","6190886","6190897","6190901","6190923","6190934","6190967","6190978","6190989","6190990","6191001","6191012","6191023","6191045","6191067","6191078","6191089","6191090","6191104","6191115","6200031","6200042","6200075","6200086","6200112","6200167","6200189","6200204","6200215","6200259","6200330","6200341","6200547","6200628","6200709","6200710","6200721","6200743","6200754","6200787","6200813","6200868","6200879","6200880","6200891","6200905","6200916","6200927","6200938","6200949","6200950","6200961","6200972","6200983","6200994","6210021","6210032","6210043","6210098","6210102","6210124","6210135","6210146","6210191","6210205","6210216","6210227","6210238","6210331","6220011","6220022","6220033","6220044","6220055","6220066","6220077","6220088","6220099","6220103","6220114","6220125","6220136","6220147","6220158","6220169","6220170","6220181","6220192","6220206","6220217","6220228","6220239","6220240","6220251","6220284","6230012","6230023","6230034","6230045","6230056","6230067","6230078","6230089","6230090","6230104","6230115","6230126","6230137","6230148","6230159","6230171","6230182","6230207","6230229","6230241","6230252","6230274","6240013","6240024","6240035","6240046","6240057","6240068","6250014","6250025","6250036","6250047","6250058","6250069","6250070","6250092","6250117","6250139","6250140","6270016","6280017","6280028","6280039","6280040","6280051","6290018","6290029","6290030","6290041","6310013","6320014","6330015","6350017","6360018","6380010","6380021","6380032","6380043","6380054","6390011","6390022","6390033","6390044","6390055","6420017","6420028","6420039","6420040","6430018","6460011","6460022","6470012","6470023","6470034","6490014","6490025","6500018","6500029","6500030","6510019","6830010","6830021","6850012","6850023","6850034","6850045","6850056","6930013","6930024","6960016","6960027","6960038","6960049","6960050","6970017","6970028","6970039","6980018","6980029","6990019","7490011","7490022","7490033","7490044","7490055","7490066","8600015","8600026","8600037","8600048","8600059","8600060","8600071","8600082","8600093","8660011","8660022","8660033","8680013","8690014","8690025","8690036","8700018","8700029","8700030","8700041","8700052","8710019","8710020","8710031","8710042","8710053","8710064","8720010","8720021","8720032","8720043","8720054","8750013","8750024","8750035","8750046","8750057","8750068","8750079","8750080","8760014","8760025","8760036","8760047","8770015","8770026","8770037","8770048","8780016","8780027","8780038","8780049","8780050","8790017","8790028","8790039","8790040","8790051","8800011","8800022","8810012","8810023","8810034","8820013","8820024","8820035","8820046","8820057","8830014","8830025","8830036","8840015","8840026","8840037","8850016","8850027","8850038","8850049","8850050","8860017","8860028","8860039","8910015","8910026","8910037","8910048","8950019","8950020","8960010","8960021","8970011","8970022","8970033","8980012","8980023","8980034","9020016","9020027","9020038","9020049","9030017","9030028","9030039","9030040","9030051","9030062","9030073","9030084","9030095","9060010","9060021","9060032","9060043","9060054","9070011","9070022","9070033","9070044","9080012","9080023","9090013","9090024","9090035","9140011","9150012","9150023","9170014","9170025","9170036","9170047","9180015","9180026","9180037","9190016","9190027","9200010","9200021","9200032","9200043","9200054","9210011","9210022","9210033","9220012","9220023","9220034","9220056","9220067","9220078","9220089","9230013","9230024","9240014","9240025","9250015","9260016","9260027","9260038","9260049","9260050","9530012","9530023","9530034","9530045"};
	
	/*
	 * 幣別
	 * [CF]台幣
	 * [FR]外幣
	 */
	private static String[] CURRENCY_TYPE_ARRAY = { "CF", "FR" };

	/*
	 * 異動代號
	 * [N]新增
	 * [U]修改
	 * [D]刪除
	 */
	private static String[] CHANGE_CODE_ARRAY = {"N"};
	//private static String[] CHANGE_CODE_ARRAY = {"N","U","D"};
	
	/*
	 * [P01]公司 
	 * [P02]住家 
	 * [P03]手機 
	 * [P04]聯絡人(公司戶)
	 * [P05]法定代理人
	 * [P06]外匯聯絡人其他
	 * [P07]外匯聯絡人手機
	 */
	private static String[] PHONE_TYPE_ARRAY = {"P03"};
	//private static String[] PHONE_TYPE_ARRAY = {"P01","P02","P03","P04","P05","P06","P07"};
	
	//檔案存放路徑
	private static String PATH = "D:\\PSC\\Projects\\全國農業金庫洗錢防制系統案\\假資料\\顧客電話資料\\";
	
	//主題
	private static String THEME = "PARTY_PHONE";
	
	//隨機日期 - 起日
	private static long BEGINTIME = Timestamp.valueOf("2013-01-01 00:00:00").getTime();
	
	//隨機日期 - 訖日
	private static long ENDTIME = Timestamp.valueOf("2018-12-31 00:58:00").getTime();

	public static void main1(String[] args) throws Exception {
		byte[] tmp =Files.readAllBytes(Paths.get(PATH+"910_FR_PARTY_PHONE_20140225.txt"));
		System.out.println(tmp.length);
	}
	public static void main(String[] args) throws Exception {

		//要創建文件的數目
		int fileCount = 1;
		
		//起始本會代號
		int domain_id = 5030019;
		
		//要產生的明細錄筆數範圍
		int detailCount = 1000000;
		
		List<String> data = new ArrayList<>();
		
		//detailCount = (int)((Math.random()*detailCount)+1);
		
		//要產生的明細錄筆數範圍
		//int detailCount = 50;
		//detailCount = (int)((Math.random()*detailCount)+1);
		
		try {
			System.out.println("資料顧客電話資料創建開始\n");
			long time1, time2;
			time1 = System.currentTimeMillis();
			
			StringBuilder executiveContent = new StringBuilder();
			
			for (int i = 0; i < fileCount; i++) {
				String central_no = Utils.getRandomValFromArray(CENTRAL_NO_ARRAY);
				String record_date = Utils.getRandomTimeBetweenTwoDates(BEGINTIME, ENDTIME);
				
				String fileName = Utils.fileNameFormat(central_no,
						Utils.getRandomValFromArray(CURRENCY_TYPE_ARRAY), THEME,
						record_date);

				Path path = Paths.get(PATH + fileName);
				
		        Files.createDirectories(path.getParent());

				//創建首錄
				Header header = new Header();
				header.setRecord_type("1");
				header.setCentral_no(central_no);
				header.setRecord_date(record_date);
				header.setReserve_field("測試資料");
				byte[] header_byte = getHeader(header);
				
				data.add(new String(header_byte, "BIG5"));
				
				for(int j=0 ; j<detailCount ; j++){
					//創建明細錄
					Detail detail = new Detail();
					detail.setRecord_type("2");
					detail.setDomain_id( Utils.getRandomValFromArray(DOMAIN_ID_ARRAY));
					detail.setParty_number(RandomValue.getUnicde());
					detail.setChange_code(Utils.getRandomValFromArray(CHANGE_CODE_ARRAY));
					detail.setPhone_type(Utils.getRandomValFromArray(PHONE_TYPE_ARRAY));
					detail.setPhone_number(RandomValue.getTel());
					byte[] detail_byte = getDetail(detail);
					
					data.add(new String(detail_byte, "BIG5"));
					
					domain_id++;
				}
				
				//創建尾錄
				Footer footer = new Footer();
				footer.setRecord_type("3");
				footer.setCentral_no(central_no);
				footer.setRecord_date(record_date);
				footer.setTotal_cnt(Utils.DigitalFillBit(detailCount, 7));
				footer.setReserve_field("測試資料");
				byte[] footer_byte = getFooter(footer);
				
				try (BufferedWriter writer = Files.newBufferedWriter(path)) {
					
					Files.write(path, data, Charset.forName("Big5"),  StandardOpenOption.CREATE, StandardOpenOption.WRITE);
					Files.write(path, footer_byte, StandardOpenOption.APPEND);
					
					executiveContent.append("檔名: ").append(fileName).append("\n");
				} catch (IOException e) {
					e.printStackTrace();
				}

			}
			System.out.println(executiveContent.toString());
			System.out.println("資料顧客電話資料創建完成，此次作業創建" + fileCount + "個檔案\n");
			
			time2 = System.currentTimeMillis();
			System.out.println("花了：" + (time2 - time1) + "豪秒");
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/*
	 * 尾錄
	 * 區別碼	R	X(01)
	 * 報送單位	R	X(07)
	 * 檔案日期	R	X(08)
	 * 總筆數	R	9(07)
	 * 保留欄	R	X(20)
	 */
	private static byte[] getFooter(Footer footer) throws UnsupportedEncodingException {
		// 區別碼
		String record_type =footer.getRecord_type();
		byte[] record_type_byte = Utils.byteFormat(record_type.getBytes("BIG5"), 1);
		
		// 報送單位
		String central_no =footer.getCentral_no();
		byte[] central_no_byte = Utils.byteFormat(central_no.getBytes("BIG5"), 7);
		
		// 檔案日期
		String record_date =footer.getRecord_date();
		byte[] record_date_byte = Utils.byteFormat(record_date.getBytes("BIG5"), 8);
		
		// 總筆數
		String total_cnt =footer.getTotal_cnt();
		byte[] total_cnt_byte = Utils.byteFormat(total_cnt.getBytes("BIG5"), 7);
		
		// 保留欄
		String reserve_field =footer.getReserve_field();
		byte[] reserve_field_byte = Utils.byteFormat(reserve_field.getBytes("BIG5"), 20);
		
		return Utils.getAllByteArray(record_type_byte, central_no_byte, record_date_byte, total_cnt_byte, reserve_field_byte);
	}
	
	/*
	 * 明細錄
	 * 區別碼	R X(01) 
	 * 本會代號 	R X(07) 
	 * 客戶統編 	R X(11) 
	 * 異動代號 	R X(01) 
	 * 電話類別 	O X(03) 
	 * 電話號碼	R X(20)
	 */
	private static byte[] getDetail(Detail detail) throws UnsupportedEncodingException {
		
		//區別碼
		String record_type = detail.getRecord_type();
		byte[] record_type_byte = Utils.byteFormat(record_type.getBytes("BIG5"), 1);

		//本會代號
		String domain_id = detail.getDomain_id();
		byte[] domain_id_byte = Utils.byteFormat(domain_id.getBytes("BIG5"), 7);

		//客戶統編
		String party_number = detail.getParty_number();
		byte[] party_number_byte = Utils.byteFormat(party_number.getBytes("BIG5"), 11);

		//異動代號
		String change_code = detail.getChange_code();
		byte[] change_code_byte = Utils.byteFormat(change_code.getBytes("BIG5"), 1);

		//電話類別
		String phone_type = detail.getPhone_type();
		byte[] phone_type_byte = Utils.byteFormat(phone_type.getBytes("BIG5"), 3);

		//電話號碼
		String phone_number = detail.getPhone_number();
		byte[] phone_number_byte = Utils.byteFormat(phone_number.getBytes("BIG5"), 20);

		return Utils.getAllByteArray(record_type_byte, domain_id_byte, party_number_byte, change_code_byte, phone_type_byte, phone_number_byte);
	}

	/*
	 * 首錄
	 * 區別碼	R	X(01)
	 * 報送單位	R	X(07)
	 * 檔案日期	R	X(08)
	 * 保留欄	R	X(27)
	 */
	private static byte[] getHeader(Header header) throws UnsupportedEncodingException {

		//區別碼
		String record_type = header.getRecord_type();
		byte[] record_type_byte = Utils.byteFormat(record_type.getBytes("BIG5"), 1);

		//報送單位
		String central_no = header.getCentral_no();
		byte[] central_no_byte = Utils.byteFormat(central_no.getBytes("BIG5"), 7);

		//檔案日期
		String record_date = header.getRecord_date();
		byte[] record_date_byte = Utils.byteFormat(record_date.getBytes("BIG5"), 8);

		//保留欄
		String reserve_field = header.getReserve_field();
		byte[] reserve_field_byte = Utils.byteFormat(reserve_field.getBytes("BIG5"), 27);

		return Utils.getAllByteArray(record_type_byte, central_no_byte, record_date_byte, reserve_field_byte);
	}

}
